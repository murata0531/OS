;************************************************************************
;	読み込みプレーンの選択
;========================================================================
;■書式		: void vga_set_read_plane(plane);
;
;■引数
;	plane	: 読み込みプレーン
;
;■戻り値	: 無し
;************************************************************************
vga_set_read_plane:
		;---------------------------------------
		; 【スタックフレームの構築】
		;---------------------------------------
												; EBP+ 8| プレーン（インデックス）
												; ------+----------------
		push	ebp								; EBP+ 4| EIP（戻り番地）
		mov		ebp, esp						; EBP+ 0| EBP（元の値）
												; ------+----------------

		;---------------------------------------
		; 【レジスタの保存】
		;---------------------------------------
		push	eax
		push	edx

		;---------------------------------------
		; 読み込みプレーンの選択
		;---------------------------------------
		mov		ah, [ebp + 8]					; AH  = プレーンを選択（3=輝度, 2～0=RGB）
		and		ah, 0x03						; AH &= 0x03; // 余計なビットをマスク
		mov		al, 0x04						; AL  = 読み込みプレーン選択レジスタ
		mov		dx, 0x03CE						; DX  = グラフィックス制御ポート
		out		dx, ax							; // ポート出力

		;---------------------------------------
		; 【レジスタの復帰】
		;---------------------------------------
		pop		edx
		pop		eax

		;---------------------------------------
		; 【スタックフレームの破棄】
		;---------------------------------------
		mov		esp, ebp
		pop		ebp

		ret


;************************************************************************
;	書き込みプレーンを選択
;========================================================================
;■書式		: void vga_set_write_plane(plane);
;
;■引数
;	plane	: 書き込みプレーン
;
;■戻り値	: 無し
;************************************************************************
vga_set_write_plane:
		;---------------------------------------
		; 【スタックフレームの構築】
		;---------------------------------------
												; EBP+ 8| プレーン（ビット指定）
												; ------+----------------
		push	ebp								; EBP+ 4| EIP（戻り番地）
		mov		ebp, esp						; EBP+ 0| EBP（元の値）
												; ------+----------------

		;---------------------------------------
		; 【レジスタの保存】
		;---------------------------------------
		push	eax
		push	edx

		;---------------------------------------
		; 書き込みプレーンの選択
		;---------------------------------------
		mov		ah, [ebp + 8]					; AH = 書き込みプレーンを指定(Bit:----IRGB)
		and		ah, 0x0F						; AH = 0x0F; // 余計なビットをマスク
		mov		al, 0x02						; AL = 書き込みプレーン選択
		mov		dx, 0x03C4						; DX = シーケンサ制御ポート
		out		dx, ax							; // ポート出力

		;---------------------------------------
		; 【レジスタの復帰】
		;---------------------------------------
		pop		edx
		pop		eax

		;---------------------------------------
		; 【スタックフレームの破棄】
		;---------------------------------------
		mov		esp, ebp
		pop		ebp

		ret